name: Accept Build Tag

# This GitHub Actions workflow detects a trigger from a dependency
# repository to update a release tag and kicks off a release.
#
# This is intended for the "final destination" project or product.
# Receiving this event means that all dependencies have been tagged,
# and it is now safe to kick off a product release.

on:
  repository_dispatch:
    types: [dependency-tag]

jobs:

  check-dependencies-and-tag:
    if: github.repository == github.event.inputs.release-repo
    runs-on: ubuntu-latest
    steps
    - uses: actions/checkout@0ad4b8fadaa221de15dcec353f45205ec38ea70b # v4.1.4
    - name: Set up JDK 17
      uses: actions/setup-java@99b8673ff64fbf99d8d325f52d9a5bdedb8483e9 # v4.2.1
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven
    - name: Check Existing Deploy
      uses: kentyou/build-automation/actions/maven-deploy-check@deb99e7439c28224de6ec8bb19f1a27691f7cfc0 # v1.1.1 to be released?
      with:
        artifact: 'artifactGroup:artifactID:artifactVersion'
        module-path: parent
        tag-name: ${{ github.ref_name }}
        cancel-workflow: 'MISSING'
        repo-secret: ${{ secrets.KENTYOU_DISPATCH_PAT }}
    - name: Create and Publish tag
      uses: kentyou/build-automation/actions/maven-tag@f08ff697ccd326ae99f9dc675a7b1b201029f5c2 # v1.1.0
      with:
        tag-name: ${{ github.event_name == 'repository_dispatch' && github.event.client_payload.tag-name || inputs.tag-name }}
        repo-secret: ${{ secrets.GITHUB_TOKEN }}

  release:
    if: github.repository == github.event.inputs.release-repo
    run: echo "Perform release of the product to production server? Or what?"
